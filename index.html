<style>
    #input {
        position: absolute;
        bottom: 1px;
        left: 0;
        height: 50px;
        width: 90%;
        resize: none;
        font-size: 20px;
    }
    #input:focus {
        outline: none;
    }
    #sendButton {
        position: absolute;
        bottom: 1px;
        right: 0;
        height: 50px;
        width: 10%;
        background-color: #4CAF50;
        color: black;
        font-size: 20px;
        cursor: pointer;
    }

    .message {
        display: grid;
        width: 100%;
        grid-template-columns: min-content min-content;
        border: 1px solid black;
        margin-bottom: 2px;
        margin-top: 2px;
    }

    #messages {
        display: flex;
        flex-direction: column-reverse;
        height: 94%;
        overflow-y: scroll;
        overflow-x: hidden;
    }
</style>
<head>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div id="messages"></div>
    <textarea id="input"></textarea>
    <div id="sendButton">Send</div>
</body>
<script>
    const socket = io();

    const input = document.getElementById('input');
    const sendButton = document.getElementById('sendButton');

    let userID = undefined;

    socket.on('userIDs', (data) => {
        if(userID === undefined) userID = data.indexOf(socket.id) + 1
    });

    function createNewMessage(user, time, date, message){
        let newMessage = document.createElement('div');
        newMessage.title = `${date} at ${time}`;
        newMessage.innerHTML = `
            <div class='message'>
                <div style="display: grid;">
                    <div id="name" style="white-space: nowrap;">
                        User #${user} says:
                    </div>
                </div>
                <br>
                <div id="body">${message}</div>
            </div>
        `;
        return newMessage;
    }

    function beginMessagePropagation(){
        if(input.value === '') return alert("You cant say nothing, dipshit.")
        let _date = new Date();
        let date = `${_date.getDate()}/${_date.getMonth() + 1}/${_date.getFullYear()}`;
        let time = `${_date.getHours()}:${_date.getMinutes()}:${String(_date.getSeconds()).padStart(2, '0')}`
        let clientMessageData = {
            userID: userID,
            message: input.value,
            time: time,
            date: date
        }
        socket.emit('clientMessageData', clientMessageData);
        console.log("sent clientMessageData to server")
        input.value = '';
    }

    sendButton.addEventListener('click', () => {
        beginMessagePropagation();
    });

    input.addEventListener('keydown', (event) => {
        if(event.key === 'Enter'){
            event.preventDefault();
            beginMessagePropagation();
        }
    });

    socket.on('messageLog', (data) => {
        console.log("received messageLog from server");
        data.forEach((message) => {
            let newMessage = createNewMessage(message.userID, message.time, message.date, message.message);
            document.getElementById('messages').prepend(newMessage);
        });
    });

    socket.on('newMessageData', (data) => {
        console.log("received newMessageData from server");
        let newMessage = createNewMessage(data.userID, data.time, data.date, data.message);
        document.getElementById('messages').prepend(newMessage);
    });
</script>